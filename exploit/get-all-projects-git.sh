#!/bin/bash
# Usage /bin/bash get-all-projects-git.sh {git_lab_host} {token_api}
###############################################

GIT_LAB_HOST=$1/api/v4/projects?per_page=1000
PRIVATE_TOKEN=$2

PROJECTS_LIST=`curl --insecure --header "Private-Token: $PRIVATE_TOKEN" $GIT_LAB_HOST | json_pp | grep "ssh_url_to_repo"
`

for linestr in $PROJECTS_LIST
do
        if [[ $linestr = *"git"* ]] && [[ $linestr != *"talend"* ]] ; then
                echo "____________________________________"
                taille=`echo ${#linestr}`
                echo "Taille de la ligne -> $taille"
                taille=$(($taille-3))
                echo "Taille de la ligne -> $taille"
                echo "Ligne: $linestr"
                git_ssh_link=`echo ${linestr:1:taille}`
                echo "git_ssh_link > $git_ssh_link"
                git clone $git_ssh_link
        fi
done
exit 0
